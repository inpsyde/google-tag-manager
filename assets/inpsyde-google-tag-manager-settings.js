!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.wp.element,a=window.wp.data,r=window.wp.coreData,l=window.wp.components,o=window.wp.i18n;const c=({spec:e,errorMessages:a,currentValue:r,onUpdate:c})=>{const s=t=>{c(e.name,t)},i=a?{borderLeft:"4px solid #d63638",paddingLeft:"10px"}:{};return(0,t.createElement)("div",{style:i},"text"===e.type&&(0,t.createElement)(l.TextControl,{label:e.label,value:r,help:e.description,onChange:s}),"select"===e.type&&(0,t.createElement)(l.SelectControl,{label:e.label,value:r,name:e.name,options:e.choices,help:e.description,onChange:s}),"checkbox"===e.type&&(0,t.createElement)(l.BaseControl,{id:e.name,label:e.label},e.choices.length>2&&(0,t.createElement)(n.Fragment,null,(0,t.createElement)(l.Button,{onClick:()=>{const t=e.choices.map((e=>e.value));s(t)}},(0,o.__)("Select all","inpsyde-google-tag-manager")),(0,t.createElement)(l.Button,{onClick:()=>s([])},(0,o.__)("Deselect all","inpsyde-google-tag-manager"))),e.choices.map((n=>{var a;return(0,t.createElement)(l.CheckboxControl,{key:n.value,checked:null!==(a=r?.includes(n.value))&&void 0!==a&&a,name:e.name,label:n.label,onChange:e=>{let t=[...r];e?t.push(n.value):t=t.filter((e=>e!==n.value)),s(t)}})})),(0,t.createElement)("p",null,e.description)),a&&a.map(((n,a)=>(0,t.createElement)("p",{key:e.name+a,className:"error-message"},n))))},s=({name:e,description:a,specification:r,settings:o,errors:s,onUpdate:i})=>(0,t.createElement)(n.Fragment,null,(0,t.createElement)(l.__experimentalSpacer,{margin:"5"}),(0,t.createElement)(l.Card,{key:e},(0,t.createElement)(l.CardHeader,null,e),a&&(0,t.createElement)(l.CardFooter,null,a),(0,t.createElement)(l.CardBody,null,r.map((e=>{var n,a;return(0,t.createElement)(c,{key:e.name,spec:e,currentValue:null!==(n=o[e.name])&&void 0!==n?n:"",errorMessages:null!==(a=s[e.name])&&void 0!==a?a:"",onUpdate:i})}))))),i=()=>(0,t.createElement)(l.Card,null,(0,t.createElement)(l.CardBody,null,(0,t.createElement)(l.Spinner,null))),d=()=>(0,t.createElement)(l.Card,null,(0,t.createElement)(l.CardBody,null,(0,t.createElement)("p",null,(0,o.__)("An error happened.","inpsyde-google-tag-manager"))));var u=window.wp.apiFetch,m=e.n(u);const p=()=>{var e,a;const[r,c]=(0,n.useState)(),[u,p]=(0,n.useState)(),[g,E]=(0,n.useState)(),[y,v]=(0,n.useState)(),[h,_]=(0,n.useState)("idle"),[f,w]=(0,n.useState)("loading");(0,n.useEffect)((()=>{(()=>{const e=InpsydeGoogleTagManager.Rest.namespace;return m()({path:e+"/data-layer",method:"GET"})})().then((e=>{c({...e.dataLayer}),p([...e.collectors]),E({...e.settings}),v({...e.errors}),w("succeeded")})).catch((e=>{w("errored")}))}),[]);const b=(e,t,n)=>{var a;const r={...g};r[e]={...null!==(a=r[e])&&void 0!==a?a:{},[t]:n},E(r)};return(0,t.createElement)("div",{className:`settings--${h}`},["loading","idle"].includes(f)&&(0,t.createElement)(i,null),"errored"===f&&(0,t.createElement)(d,null),"succeeded"===f&&(0,t.createElement)(n.Fragment,null,(0,t.createElement)(s,{key:r.id,name:(0,o.__)("DataLayer - General settings","inpsyde-google-tag-manager"),specification:r.specification,settings:null!==(e=g[r.id])&&void 0!==e?e:{},errors:null!==(a=y[r.id])&&void 0!==a?a:{},onUpdate:(e,t)=>{b(r.id,e,t)}}),u.map((e=>{var n,a;return(e=>{var t;const n=null!==(t=g[r.id]?.enabled_collectors)&&void 0!==t?t:[];return g&&n.includes(e)})(e.id)&&(0,t.createElement)(s,{key:e.id,name:e.name,description:e.description,specification:e.specification,settings:null!==(n=g[e.id])&&void 0!==n?n:{},errors:null!==(a=y[e.id])&&void 0!==a?a:{},onUpdate:(t,n)=>{b(e.id,t,n)}})})),(0,t.createElement)(l.__experimentalSpacer,{margin:5}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{_("saving"),(e=>{const t=InpsydeGoogleTagManager.Rest.namespace;return m()({path:t+"/data-layer",method:"POST",data:e})})(g).then((e=>{v(e.errors),_(0===Object.keys(e.errors).length?"succeeded":"errored"),E(e.settings)}))},disabled:"saving"===h},"saving"===h?(0,t.createElement)("div",null,(0,t.createElement)(l.Spinner,null),(0,o.__)("Savingâ€¦","inpsyde-google-tag-manager")):(0,o.__)("Save","inpsyde-google-tag-manager")),"errored"===h&&(0,t.createElement)(l.Snackbar,{status:"error"},(0,o.__)("An error happened. Please check your settings for error messages.","inpsyde-google-tag-manager")),"succeeded"===h&&(0,t.createElement)(l.Snackbar,{status:"success"},(0,o.__)("New settings successfully stored.","inpsyde-google-tag-manager"))))};(0,a.dispatch)(r.store).addEntities(Array.from(InpsydeGoogleTagManager.Entities));const g=document.querySelector(".settings__content");g&&(0,n.createRoot)(g).render((0,t.createElement)(p,null))}();