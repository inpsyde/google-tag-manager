!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,n=window.wp.element,a=window.wp.data,r=window.wp.coreData,l=window.wp.components,o=window.wp.i18n;const s=({spec:e,errorMessages:a,currentValue:r,onUpdate:s})=>{const c=t=>{s(e.name,t)},i=a?{borderLeft:"4px solid #d63638",paddingLeft:"10px"}:{};return(0,t.createElement)("div",{style:i},"text"===e.type&&(0,t.createElement)(l.TextControl,{label:e.label,value:r,help:e.description,onChange:c}),"select"===e.type&&(0,t.createElement)(l.SelectControl,{label:e.label,value:r,name:e.name,options:e.choices,help:e.description,onChange:c}),"checkbox"===e.type&&(0,t.createElement)(l.BaseControl,{id:e.name,label:e.label},e.choices.length>2&&(0,t.createElement)(n.Fragment,null,(0,t.createElement)(l.Button,{onClick:()=>{const t=e.choices.map((e=>e.value));c(t)}},(0,o.__)("Select all","inpsyde-google-tag-manager")),(0,t.createElement)(l.Button,{onClick:()=>c([])},(0,o.__)("Deselect all","inpsyde-google-tag-manager"))),e.choices.map((n=>{var a;return(0,t.createElement)(l.CheckboxControl,{key:n.value,checked:null!==(a=r?.includes(n.value))&&void 0!==a&&a,name:e.name,label:n.label,onChange:e=>{let t=[...r];e?t.push(n.value):t=t.filter((e=>e!==n.value)),c(t)}})})),(0,t.createElement)("p",null,e.description)),a&&a.map(((n,a)=>(0,t.createElement)("p",{key:e.name+a,className:"error-message"},n))))},c=({name:e,description:a,specification:r,settings:o,errors:c,onUpdate:i})=>(0,t.createElement)(n.Fragment,null,(0,t.createElement)(l.__experimentalSpacer,{margin:"5"}),(0,t.createElement)(l.Card,{key:e},(0,t.createElement)(l.CardHeader,null,e),a&&(0,t.createElement)(l.CardFooter,null,a),(0,t.createElement)(l.CardBody,null,r.map((e=>{var n,a;return(0,t.createElement)(s,{key:e.name,spec:e,currentValue:null!==(n=o[e.name])&&void 0!==n?n:"",errorMessages:null!==(a=c[e.name])&&void 0!==a?a:"",onUpdate:i})})))));var i,d,m,u;function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},g.apply(null,arguments)}const p=e=>t.createElement("svg",g({xmlns:"http://www.w3.org/2000/svg",width:41,height:40,fill:"none",style:{scale:"75%",animation:"innerbeat 1.5s infinite linear forwards",filter:"url(#leaf-beat_svg__shadow)"}},e),i||(i=t.createElement("filter",{id:"leaf-beat_svg__shadow",colorInterpolationFilters:"sRGB"},t.createElement("feDropShadow",{dx:2,dy:2,floodOpacity:.2,stdDeviation:3}))),d||(d=t.createElement("style",null,"@keyframes innerbeat{0%,10%{transform:scale(1)}50%{transform:scale(1.15)}60%{transform:scale(1.05)}75%{transform:scale(1.2)}}")),m||(m=t.createElement("path",{fill:"#9FCA28",d:"M4.758 39.76h19.528c8.807 0 15.945-7.1 15.945-15.861V1.926C17 13.38 4.758 39.761 4.758 39.761"})),u||(u=t.createElement("path",{fill:"#9FCA28",d:"M37.923 0H16.176C7.372 0 .23 7.1.23 15.862v16.75S8.77 14.76 37.919 0z"}))),E=()=>(0,t.createElement)(l.Card,null,(0,t.createElement)(l.CardBody,null,(0,t.createElement)(l.__experimentalHStack,{justify:"start",spacing:"4"},(0,t.createElement)(p,null),(0,t.createElement)(l.__experimentalText,{size:"large"},(0,o.__)("Loading…","inpsyde-google-tag-manager"))))),v=()=>(0,t.createElement)(l.Card,null,(0,t.createElement)(l.CardBody,null,(0,t.createElement)("p",null,(0,o.__)("An error happened.","inpsyde-google-tag-manager"))));var y=window.wp.apiFetch,f=e.n(y);const h=()=>{var e,a;const[r,s]=(0,n.useState)(),[i,d]=(0,n.useState)(),[m,u]=(0,n.useState)(),[g,p]=(0,n.useState)(),[y,h]=(0,n.useState)("idle"),[_,w]=(0,n.useState)("loading");(0,n.useEffect)((()=>{(()=>{const e=InpsydeGoogleTagManager.Rest.namespace;return f()({path:e+"/settings-page",method:"GET"})})().then((e=>{s({...e.dataLayer}),d([...e.collectors]),u({...e.settings}),p({...e.errors}),w("succeeded")})).catch((e=>{w("errored")}))}),[]);const b=(e,t,n)=>{var a;const r={...m};r[e]={...null!==(a=r[e])&&void 0!==a?a:{},[t]:n},u(r)};return(0,t.createElement)("div",{className:`settings--${y}`},["loading","idle"].includes(_)&&(0,t.createElement)(E,null),"errored"===_&&(0,t.createElement)(v,null),"succeeded"===_&&(0,t.createElement)(n.Fragment,null,(0,t.createElement)(c,{key:r.id,name:(0,o.__)("DataLayer - General settings","inpsyde-google-tag-manager"),specification:r.specification,settings:null!==(e=m[r.id])&&void 0!==e?e:{},errors:null!==(a=g[r.id])&&void 0!==a?a:{},onUpdate:(e,t)=>{b(r.id,e,t)}}),i.map((e=>{var n,a;return(e=>{var t;const n=null!==(t=m[r.id]?.enabled_collectors)&&void 0!==t?t:[];return m&&n.includes(e)})(e.id)&&(0,t.createElement)(c,{key:e.id,name:e.name,description:e.description,specification:e.specification,settings:null!==(n=m[e.id])&&void 0!==n?n:{},errors:null!==(a=g[e.id])&&void 0!==a?a:{},onUpdate:(t,n)=>{b(e.id,t,n)}})})),(0,t.createElement)(l.__experimentalSpacer,{margin:5}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{h("saving"),(e=>{const t=InpsydeGoogleTagManager.Rest.namespace;return f()({path:t+"/settings-page",method:"POST",data:e})})(m).then((e=>{p(e.errors),h(0===Object.keys(e.errors).length?"succeeded":"errored"),u(e.settings)}))},disabled:"saving"===y},"saving"===y?(0,t.createElement)("div",null,(0,t.createElement)(l.Spinner,null),(0,o.__)("Saving…","inpsyde-google-tag-manager")):(0,o.__)("Save","inpsyde-google-tag-manager")),"errored"===y&&(0,t.createElement)(l.Snackbar,{status:"error"},(0,o.__)("An error happened. Please check your settings for error messages.","inpsyde-google-tag-manager")),"succeeded"===y&&(0,t.createElement)(l.Snackbar,{status:"success"},(0,o.__)("New settings successfully stored.","inpsyde-google-tag-manager"))))};(0,a.dispatch)(r.store).addEntities(Array.from(InpsydeGoogleTagManager.Entities));const _=document.querySelector(".settings__content");_&&(0,n.createRoot)(_).render((0,t.createElement)(h,null))}();