!function(){"use strict";var e={n:function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,{a:a}),a},d:function(t,a){for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.React,a=window.wp.element,n=window.wp.data,r=window.wp.coreData,l=window.wp.components,o=window.wp.i18n;const s=({spec:e,errorMessages:n,currentValue:r,onUpdate:s})=>{const c=t=>{s(e.name,t)},i=n?{borderLeft:"4px solid #d63638",paddingLeft:"10px"}:{};return(0,t.createElement)("div",{style:i},"text"===e.type&&(0,t.createElement)(l.TextControl,{label:e.label,value:r,help:e.description,onChange:c}),"select"===e.type&&(0,t.createElement)(l.SelectControl,{label:e.label,value:r,name:e.name,options:e.choices,help:e.description,onChange:c}),"checkbox"===e.type&&(0,t.createElement)(l.BaseControl,{id:e.name,label:e.label},e.choices.length>2&&(0,t.createElement)(a.Fragment,null,(0,t.createElement)(l.Button,{onClick:()=>{const t=e.choices.map((e=>e.value));c(t)}},(0,o.__)("Select all","inpsyde-google-tag-manager")),(0,t.createElement)(l.Button,{onClick:()=>c([])},(0,o.__)("Deselect all","inpsyde-google-tag-manager"))),e.choices.map((a=>{var n;return(0,t.createElement)(l.CheckboxControl,{key:a.value,checked:null!==(n=r?.includes(a.value))&&void 0!==n&&n,name:e.name,label:a.label,onChange:e=>{let t=[...r];e?t.push(a.value):t=t.filter((e=>e!==a.value)),c(t)}})})),(0,t.createElement)("p",null,e.description)),n&&n.map(((a,n)=>(0,t.createElement)("p",{key:e.name+n,className:"error-message"},a))))},c=({name:e,description:n,specification:r,settings:o,errors:c,onUpdate:i})=>(0,t.createElement)(a.Fragment,null,(0,t.createElement)(l.__experimentalSpacer,{margin:"5"}),(0,t.createElement)(l.Card,{key:e},(0,t.createElement)(l.CardHeader,null,e),n&&(0,t.createElement)(l.CardFooter,null,n),(0,t.createElement)(l.CardBody,null,r.map((e=>{var a,n;return(0,t.createElement)(s,{key:e.name,spec:e,currentValue:null!==(a=o[e.name])&&void 0!==a?a:"",errorMessages:null!==(n=c[e.name])&&void 0!==n?n:"",onUpdate:i})})))));var i,d,m,u;function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},g.apply(null,arguments)}const p=e=>t.createElement("svg",g({xmlns:"http://www.w3.org/2000/svg",width:41,height:40,fill:"none",style:{scale:"75%",animation:"innerbeat 1.5s infinite linear forwards",filter:"url(#leaf-beat_svg__shadow)"}},e),i||(i=t.createElement("filter",{id:"leaf-beat_svg__shadow",colorInterpolationFilters:"sRGB"},t.createElement("feDropShadow",{dx:2,dy:2,floodOpacity:.2,stdDeviation:3}))),d||(d=t.createElement("style",null,"@keyframes innerbeat{0%,10%{transform:scale(1)}50%{transform:scale(1.15)}60%{transform:scale(1.05)}75%{transform:scale(1.2)}}")),m||(m=t.createElement("path",{fill:"#9FCA28",d:"M4.758 39.76h19.528c8.807 0 15.945-7.1 15.945-15.861V1.926C17 13.38 4.758 39.761 4.758 39.761"})),u||(u=t.createElement("path",{fill:"#9FCA28",d:"M37.923 0H16.176C7.372 0 .23 7.1.23 15.862v16.75S8.77 14.76 37.919 0z"}))),E=()=>(0,t.createElement)(l.Card,null,(0,t.createElement)(l.CardBody,null,(0,t.createElement)(l.__experimentalHStack,{justify:"start",spacing:"4"},(0,t.createElement)(p,null),(0,t.createElement)(l.__experimentalText,{size:"large"},(0,o.__)("Loading…","inpsyde-google-tag-manager"))))),v=()=>(0,t.createElement)(l.Card,null,(0,t.createElement)(l.CardBody,null,(0,t.createElement)("p",null,(0,o.__)("An error happened.","inpsyde-google-tag-manager"))));var y=window.wp.apiFetch,f=e.n(y);const h=()=>{var e,n;const[r,s]=(0,a.useState)(),[i,d]=(0,a.useState)(),[m,u]=(0,a.useState)(),[g,p]=(0,a.useState)(),[y,h]=(0,a.useState)("idle"),[_,w]=(0,a.useState)("loading");(0,a.useEffect)((()=>{(()=>{const e=InpsydeGoogleTagManager.Rest.namespace;return f()({path:e+"/settings-page",method:"GET"})})().then((e=>{s({...e.data.dataLayer}),d([...e.data.collectors]),u({...e.data.settings}),p({...e.data.errors}),w("succeeded")})).catch((e=>{w("errored")}))}),[]);const b=(e,t,a)=>{var n;const r={...m};r[e]={...null!==(n=r[e])&&void 0!==n?n:{},[t]:a},u(r)};return(0,t.createElement)("div",{className:`settings settings--${y}`},["loading","idle"].includes(_)&&(0,t.createElement)(E,null),"errored"===_&&(0,t.createElement)(v,null),"succeeded"===_&&(0,t.createElement)(a.Fragment,null,(0,t.createElement)(c,{key:r.id,name:(0,o.__)("DataLayer - General settings","inpsyde-google-tag-manager"),specification:r.specification,settings:null!==(e=m[r.id])&&void 0!==e?e:{},errors:null!==(n=g[r.id])&&void 0!==n?n:{},onUpdate:(e,t)=>{b(r.id,e,t)}}),i.map((e=>{var a,n;return(e=>{var t;const a=null!==(t=m[r.id]?.enabled_collectors)&&void 0!==t?t:[];return m&&a.includes(e)})(e.id)&&(0,t.createElement)(c,{key:e.id,name:e.name,description:e.description,specification:e.specification,settings:null!==(a=m[e.id])&&void 0!==a?a:{},errors:null!==(n=g[e.id])&&void 0!==n?n:{},onUpdate:(t,a)=>{b(e.id,t,a)}})})),(0,t.createElement)(l.__experimentalSpacer,{margin:5}),(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>{h("saving"),(e=>{const t=InpsydeGoogleTagManager.Rest.namespace;return f()({path:t+"/settings-page",method:"POST",data:e})})(m).then((e=>{p(e.data.errors),h(0===Object.keys(e.data.errors).length&&e.success?"succeeded":"errored"),u(e.data.settings)}))},disabled:"saving"===y},"saving"===y?(0,t.createElement)("div",null,(0,t.createElement)(l.Spinner,null),(0,o.__)("Saving…","inpsyde-google-tag-manager")):(0,o.__)("Save","inpsyde-google-tag-manager")),"errored"===y&&(0,t.createElement)(l.Snackbar,{status:"error"},(0,o.__)("An error happened. Please check your settings for error messages.","inpsyde-google-tag-manager")),"succeeded"===y&&(0,t.createElement)(l.Snackbar,{status:"success"},(0,o.__)("New settings successfully stored.","inpsyde-google-tag-manager"))))};(0,n.dispatch)(r.store).addEntities(Array.from(InpsydeGoogleTagManager.Entities));const _=document.querySelector(".settings__content");_&&(0,a.createRoot)(_).render((0,t.createElement)(h,null))}();